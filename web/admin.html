<!doctype html>
<html>
<head><meta charset="utf-8"><title>Admin</title><link rel="stylesheet" href="/css/style.css"></head>
<body>
  <div class="card">
    <h2>Admin — Orders</h2>
    <ul id="orders"></ul>
  </div>
<script>
const token=localStorage.getItem('token'), role=localStorage.getItem('role');
if(!token) location.href='/login.html';
if(role!=='admin'){ alert('Admins only'); location.href='/dashboard.html'; }

async function load(){
  const res=await fetch('/api/admin/orders',{headers:{Authorization:'Bearer '+token}});
  const orders=await res.json();
  const ul=document.getElementById('orders'); ul.innerHTML='';
  orders.forEach(o=>{
    const li=document.createElement('li');
    li.textContent=`#${o.id} ${o.description} — ${o.status}`;
    const b=document.createElement('button'); b.textContent='Mark delivered';
    b.onclick=async ()=>{ await fetch('/api/admin/orders/'+o.id+'/status',{method:'POST',headers:{'Content-Type':'application/json', Authorization:'Bearer '+token},body:JSON.stringify({status:'delivered'})}); load(); };
    li.appendChild(b);
    ul.appendChild(li);
  });
}
load(); setInterval(load,5000);
</script>
</body>
</html>
