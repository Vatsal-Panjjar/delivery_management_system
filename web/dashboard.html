<!doctype html>
<html>
<head><meta charset="utf-8"><title>Dashboard</title><link rel="stylesheet" href="/css/style.css"></head>
<body>
  <div class="card">
    <h2>Your Orders</h2>
    <form id="orderForm"><input name="description" placeholder="description"><button>Create</button></form>
    <ul id="orders"></ul>
    <p><a href="/admin.html" id="adminLink" style="display:none">Admin dashboard</a></p>
  </div>

<script>
const token=localStorage.getItem('token'), role=localStorage.getItem('role');
if(!token) location.href='/login.html';
if(role==='admin') document.getElementById('adminLink').style.display='block';

async function load(){
  const res=await fetch('/api/orders',{headers:{Authorization:'Bearer '+token}});
  const orders=await res.json();
  const ul=document.getElementById('orders'); ul.innerHTML='';
  orders.forEach(o=>{
    const li=document.createElement('li');
    li.textContent=`#${o.id} ${o.description} â€” ${o.status}`;
    if(o.status!=='cancelled'){
      const b=document.createElement('button'); b.textContent='Cancel';
      b.onclick=async ()=>{ await fetch('/api/orders/'+o.id+'/cancel',{method:'POST',headers:{Authorization:'Bearer '+token}}); load(); };
      li.appendChild(b);
    }
    ul.appendChild(li);
  });
}
document.getElementById('orderForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const desc=new FormData(e.target).get('description');
  await fetch('/api/orders',{method:'POST',headers:{'Content-Type':'application/json', Authorization:'Bearer '+token},body:JSON.stringify({description:desc})});
  load();
});
load();
setInterval(load,5000);
</script>
</body>
</html>
